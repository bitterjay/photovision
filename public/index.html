<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhotoVision - Conversational Image Discovery</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <div class="header-title">
                    <h1>PhotoVision</h1>
                    <p>Search your SmugMug photos with natural language</p>
                </div>
                <div class="header-controls">
                    <div class="theme-toggle" id="themeToggle">
                        <button class="theme-btn" data-theme="light" title="Light Mode">
                            <svg class="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="5"></circle>
                                <path d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"></path>
                            </svg>
                        </button>
                        <button class="theme-btn active" data-theme="auto" title="Auto (System)">
                            <svg class="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                                <line x1="8" y1="21" x2="16" y2="21"></line>
                                <line x1="12" y1="17" x2="12" y2="21"></line>
                            </svg>
                        </button>
                        <button class="theme-btn" data-theme="dark" title="Dark Mode">
                            <svg class="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <nav class="tab-navigation">
            <button class="tab-btn active" data-tab="chat">
                <img src="img/claude-icon.svg" alt="Claude" class="tab-icon">
                <span>Chat</span>
            </button>
            <button class="tab-btn" data-tab="batch">
                <img src="img/smugmug-icon.svg" alt="SmugMug" class="tab-icon">
                <span>Batch Processing</span>
            </button>
            <button class="tab-btn" data-tab="admin">
                <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 1l3 6 6 .75-4.15 4.2.9 6.05L12 15l-5.75 3-0.9-6.05L1 7.75 7 7l3-6z"></path>
                    <path d="M12 6.5l1.5 3 3 .375-2.075 2.1.45 3.025L12 13.5l-2.875 1.5.45-3.025L7.5 9.875l3-.375L12 6.5z"></path>
                </svg>
                <span>Admin Tools</span>
            </button>
            <button class="tab-btn" data-tab="dashboard">
                <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"></path>
                    <polyline points="9,22 9,12 15,12 15,22"></polyline>
                </svg>
                <span>Dashboard</span>
            </button>
        </nav>

        <main class="main">
            <div class="status-bar" id="status">
                <span class="status-text">Initializing...</span>
            </div>

            <!-- Chat Tab -->
            <div class="tab-panel active" id="chatTab">
                <div class="chat-container">
                    <div class="messages" id="messages">
                        <div class="message system">
                            <div class="message-content">
                                Welcome to PhotoVision! Once you connect your SmugMug account and process your photos, you'll be able to search using natural language queries like "10 photos of young adults smiling" or "photos that feel nostalgic from summer evenings."
                            </div>
                        </div>
                    </div>
                    
                    <div class="input-container">
                        <input type="text" id="messageInput" placeholder="Ask me to find photos: 'show me archery photos' or 'find 3 smiling people'..." disabled>
                        <button id="sendButton" disabled>Send</button>
                    </div>
                </div>

                <div class="upload-section">
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-content">
                            <div class="upload-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path>
                                    <polyline points="7,10 12,15 17,10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                            </div>
                            <h3>Upload Images</h3>
                            <p>Drag and drop images here or click to select</p>
                            <input type="file" id="fileInput" accept="image/*" style="display: none;">
                            <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                                Choose Image
                            </button>
                        </div>
                    </div>
                    <div class="upload-progress" id="uploadProgress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <span class="progress-text" id="progressText">Analyzing...</span>
                    </div>
                    <div class="analysis-result" id="analysisResult" style="display: none;">
                        <h4>Analysis Result:</h4>
                        <div class="result-content" id="resultContent"></div>
                    </div>
                </div>
            </div>

            <!-- Batch Processing Tab -->
            <div class="tab-panel" id="batchTab">
                <div class="batch-processing-section">
                    <div class="section-header">
                        <h3>Album Batch Processing</h3>
                        <button id="refreshAlbums" class="refresh-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23,4 23,10 17,10"></polyline>
                                <polyline points="1,20 1,14 7,14"></polyline>
                                <path d="M20.49,9A9,9,0,0,0,5.64,5.64L1,10m22,4-4.64,4.36A9,9,0,0,1,3.51,15"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="albums-container">
                        <div class="albums-header">
                            <h4>Select Album to Process</h4>
                            <span class="album-count" id="albumCount">Loading...</span>
                        </div>
                        
                        <div class="albums-list" id="albumsList">
                            <div class="loading-albums">
                                <div class="loading-spinner"></div> Loading albums...
                            </div>
                        </div>
                    </div>
                    
                    <div class="batch-controls">
                        <div class="batch-settings">
                            <div class="setting-group">
                                <label for="maxImages">Max Images:</label>
                                <input type="number" id="maxImages" value="50" min="1" max="200">
                            </div>
                            
                            <div class="setting-group">
                                <label for="batchName">Batch Name:</label>
                                <input type="text" id="batchName" placeholder="Optional batch name">
                            </div>
                            <div class="control-buttons">
                            <button id="startBatch" class="btn btn-primary" disabled>
                                <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="5,3 19,12 5,21"></polygon>
                                </svg>
                                Start Processing
                            </button>
                            <button id="pauseBatch" class="btn btn-secondary" disabled>
                                <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="6" y="4" width="4" height="16"></rect>
                                    <rect x="14" y="4" width="4" height="16"></rect>
                                </svg>
                                Pause
                            </button>
                            <button id="resumeBatch" class="btn btn-secondary" disabled>
                                <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="5,3 19,12 5,21"></polygon>
                                </svg>
                                Resume
                            </button>
                            <button id="cancelBatch" class="btn btn-danger" disabled>
                                <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                                Cancel
                            </button>
                        </div>
                            
                            <div class="duplicate-settings">
                                <div class="setting-group">
                                    <label for="duplicateHandling">Duplicate Handling:</label>
                                    <select id="duplicateHandling">
                                        <option value="skip">Skip duplicates (recommended)</option>
                                        <option value="update">Update existing records</option>
                                        <option value="replace">Replace existing records</option>
                                    </select>
                                </div>
                                
                                <label class="checkbox-label">
                                    <input type="checkbox" id="forceReprocessing">
                                    <span class="checkmark"></span>
                                    Force reprocess all images
                                </label>
                            </div>
                        </div>
                        
                        
                    </div>
                    
                    <div class="batch-progress" id="batchProgress" style="display: none;">
                        <div class="progress-header">
                            <h4>Processing Progress</h4>
                            <span class="batch-status" id="batchStatus">Idle</span>
                        </div>
                        
                        <div class="progress-bar-container">
                            <div class="progress-bar">
                                <div class="progress-fill" id="batchProgressFill"></div>
                            </div>
                            <span class="progress-percentage" id="progressPercentage">0%</span>
                        </div>
                        
                        <div class="progress-stats">
                            <div class="stat-item">
                                <span class="stat-label">Processed:</span>
                                <span class="stat-value" id="processedCount">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Total:</span>
                                <span class="stat-value" id="totalCount">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Failed:</span>
                                <span class="stat-value" id="failedCount">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Remaining:</span>
                                <span class="stat-value" id="remainingCount">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Tools Tab -->
            <div class="tab-panel" id="adminTab">
                <div class="admin-tools-section">
                    <div class="section-header">
                        <h3>Admin Tools</h3>
                        <div class="admin-badge">
                            <svg class="admin-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 1l3 6 6 .75-4.15 4.2.9 6.05L12 15l-5.75 3-0.9-6.05L1 7.75 7 7l3-6z"></path>
                            </svg>
                            <span>Advanced</span>
                        </div>
                    </div>
                    
                    <div class="admin-controls" id="adminControls">
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <h4>
                                    <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <path d="M21 21l-4.35-4.35"></path>
                                    </svg>
                                    Duplicate Detection & Cleanup
                                </h4>
                                <p class="card-description">Manage duplicate image records in the database</p>
                            </div>
                            
                            <div class="admin-card-content">
                                <div class="control-group">
                                    <button id="analyzeDuplicates" class="btn btn-primary">
                                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="11" cy="11" r="8"></circle>
                                            <path d="M21 21l-4.35-4.35"></path>
                                        </svg>
                                        Analyze Duplicates
                                    </button>
                                    <button id="refreshDuplicateInfo" class="btn btn-secondary">
                                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="23,4 23,10 17,10"></polyline>
                                            <polyline points="1,20 1,14 7,14"></polyline>
                                            <path d="M20.49,9A9,9,0,0,0,5.64,5.64L1,10m22,4-4.64,4.36A9,9,0,0,1,3.51,15"></path>
                                        </svg>
                                        Refresh
                                    </button>
                                </div>
                                
                                <div class="duplicate-analysis" id="duplicateAnalysis" style="display: none;">
                                    <div class="analysis-results">
                                        <h5>Analysis Results</h5>
                                        <div class="stats-grid">
                                            <div class="stat-card">
                                                <div class="stat-value" id="totalImagesAnalyzed">0</div>
                                                <div class="stat-label">Total Images</div>
                                            </div>
                                            <div class="stat-card">
                                                <div class="stat-value" id="duplicateGroupsFound">0</div>
                                                <div class="stat-label">Duplicate Groups</div>
                                            </div>
                                            <div class="stat-card">
                                                <div class="stat-value" id="recordsToRemove">0</div>
                                                <div class="stat-label">Records to Remove</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="admin-card danger-zone">
                            <div class="admin-card-header">
                                <h4>
                                    <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3,6 5,6 21,6"></polyline>
                                        <path d="M19,6V20a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6M8,6V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"></path>
                                    </svg>
                                    Data Destruction (Testing Only)
                                </h4>
                                <p class="card-description warning">This will permanently delete all image data. Use only for testing purposes.</p>
                            </div>
                            
                            <div class="admin-card-content">
                                <div class="data-info">
                                    <span class="data-count">Current records: <span id="recordCount">Loading...</span></span>
                                </div>
                                
                                <button id="destroyAllData" class="btn btn-danger">
                                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3,6 5,6 21,6"></polyline>
                                        <path d="M19,6V20a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6M8,6V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"></path>
                                    </svg>
                                    Destroy All Image Data
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div class="tab-panel" id="dashboardTab">
                <div class="dashboard-section">
                    <div class="section-header">
                        <h3>System Status</h3>
                        <button id="refreshStatus" class="refresh-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23,4 23,10 17,10"></polyline>
                                <polyline points="1,20 1,14 7,14"></polyline>
                                <path d="M20.49,9A9,9,0,0,0,5.64,5.64L1,10m22,4-4.64,4.36A9,9,0,0,1,3.51,15"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="services-grid">
                        <div class="service-card" id="claudeStatusCard">
                            <div class="service-icon">
                                <img src="img/claude-icon.svg" alt="Claude AI" class="service-icon-img">
                            </div>
                            <div class="service-info">
                                <div class="service-name">Claude AI</div>
                                <div class="service-status" id="claudeStatus">
                                    <span class="status-indicator checking"></span>
                                    <span class="status-text">Checking...</span>
                                </div>
                            </div>
                            <button id="testClaude" class="btn btn-secondary">Test</button>
                        </div>
                        
                        <div class="service-card" id="smugmugStatusCard">
                            <div class="service-icon">
                                <img src="img/smugmug-icon.svg" alt="SmugMug" class="service-icon-img">
                            </div>
                            <div class="service-info">
                                <div class="service-name">SmugMug</div>
                                <div class="service-status" id="smugmugStatus">
                                    <span class="status-indicator disconnected"></span>
                                    <span class="status-text">Not Connected</span>
                                </div>
                            </div>
                            <div class="service-actions">
                                <button id="connectSmugmug" class="btn btn-primary">Connect</button>
                                <button id="testSmugmug" class="btn btn-secondary" disabled>Test</button>
                                <button id="disconnectSmugmug" class="btn btn-danger" disabled>Disconnect</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="account-info" id="smugmugAccountInfo" style="display: none;">
                        <h4>Connected SmugMug Account</h4>
                        <div class="account-details" id="accountDetails"></div>
                    </div>
                    
                    <div class="last-checked">
                        <small>Last checked: <span id="lastChecked">Never</span></small>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Lightbox Modal -->
    <div id="imageModal" class="image-modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-container">
            <button class="modal-close" id="closeModal">&times;</button>
            <div class="swiper-container" id="imageSwiper">
                <div class="swiper-wrapper" id="swiperWrapper">
                    <!-- Slides will be populated dynamically -->
                </div>
                <div class="swiper-pagination"></div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
            </div>
            <div class="image-info" id="imageInfo">
                <div class="image-counter" id="imageCounter">1 / 1</div>
                <div class="image-title" id="imageTitle">Image Title</div>
            </div>
        </div>
    </div>

    <!-- Fixed Bottom Progress Info Bar -->
    <div id="bottomProgressBar" class="bottom-progress-bar" style="display: none;">
        <div class="progress-info-container">
            <div class="progress-bar-section">
                <div class="progress-bar-mini">
                    <div class="progress-fill-mini" id="bottomProgressFill"></div>
                </div>
                <span class="progress-percentage-mini" id="bottomProgressPercentage">0%</span>
            </div>
            
            <div class="progress-details">
                <span class="current-file" id="currentJobName" title="">Processing...</span>
                <span class="progress-stats-mini">
                    (<span id="bottomProcessedCount">0</span> of <span id="bottomTotalCount">0</span>)
                </span>
            </div>
            
            <div class="progress-status">
                <span class="status-indicator" id="bottomBatchStatus">Processing</span>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
