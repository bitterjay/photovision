<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhotoVision - Conversational Image Discovery</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>PhotoVision</h1>
            <p>Search your SmugMug photos with natural language</p>
        </header>

        <main class="main">
            <div class="status-bar" id="status">
                <span class="status-text">Initializing...</span>
            </div>
            <div class="chat-container">
                <div class="messages" id="messages">
                    <div class="message system">
                        <div class="message-content">
                            Welcome to PhotoVision! Once you connect your SmugMug account and process your photos, you'll be able to search using natural language queries like "10 photos of young adults smiling" or "photos that feel nostalgic from summer evenings."
                        </div>
                    </div>
                </div>
                
                <div class="input-container">
                    <input type="text" id="messageInput" placeholder="Ask me to find photos: 'show me archery photos' or 'find 3 smiling people'..." disabled>
                    <button id="sendButton" disabled>Send</button>
                </div>
            </div>

            <div class="upload-section">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-content">
                        <i class="upload-icon">üì§</i>
                        <h3>Upload Images</h3>
                        <p>Drag and drop images here or click to select</p>
                        <input type="file" id="fileInput" accept="image/*" style="display: none;">
                        <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                            Choose Image
                        </button>
                    </div>
                </div>
                <div class="upload-progress" id="uploadProgress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <span class="progress-text" id="progressText">Analyzing...</span>
                </div>
                <div class="analysis-result" id="analysisResult" style="display: none;">
                    <h4>Analysis Result:</h4>
                    <div class="result-content" id="resultContent"></div>
                </div>
            </div>

            <div class="connections-dashboard">
                <div class="dashboard-header">
                    <h3>System Status</h3>
                    <button id="refreshStatus" class="refresh-btn">üîÑ</button>
                </div>
                
                <div class="services-grid">
                    <div class="service-card" id="claudeStatusCard">
                        <div class="service-icon">ü§ñ</div>
                        <div class="service-info">
                            <div class="service-name">Claude AI</div>
                            <div class="service-status" id="claudeStatus">
                                <span class="status-indicator checking"></span>
                                <span class="status-text">Checking...</span>
                            </div>
                        </div>
                        <button id="testClaude" class="test-btn">Test</button>
                    </div>
                    
                    <div class="service-card" id="smugmugStatusCard">
                        <div class="service-icon">üì∏</div>
                        <div class="service-info">
                            <div class="service-name">SmugMug</div>
                            <div class="service-status" id="smugmugStatus">
                                <span class="status-indicator disconnected"></span>
                                <span class="status-text">Not Connected</span>
                            </div>
                        </div>
                        <div class="smugmug-controls">
                            <button id="connectSmugmug" class="connect-btn">Connect</button>
                            <button id="testSmugmug" class="test-btn" disabled>Test</button>
                            <button id="disconnectSmugmug" class="disconnect-btn" disabled>Disconnect</button>
                        </div>
                    </div>
                </div>
                
                <div class="smugmug-account-info" id="smugmugAccountInfo" style="display: none;">
                    <h4>Connected SmugMug Account</h4>
                    <div class="account-details" id="accountDetails"></div>
                </div>
                
                <div class="last-checked">
                    <small>Last checked: <span id="lastChecked">Never</span></small>
                </div>
            </div>

            <div class="batch-processing-section" id="batchProcessingSection" style="display: none;">
                <div class="section-header">
                    <h3>üìÅ Album Batch Processing</h3>
                    <button id="refreshAlbums" class="refresh-btn">üîÑ</button>
                </div>
                
                <div class="albums-container">
                    <div class="albums-header">
                        <h4>Select Album to Process</h4>
                        <span class="album-count" id="albumCount">Loading...</span>
                    </div>
                    
                    <div class="albums-list" id="albumsList">
                        <div class="loading-albums">
                            <span class="loading"></span> Loading albums...
                        </div>
                    </div>
                </div>
                
                <div class="batch-controls">
                    <div class="batch-settings">
                        <label for="maxImages">Max Images:</label>
                        <input type="number" id="maxImages" value="50" min="1" max="200">
                        
                        <label for="batchName">Batch Name:</label>
                        <input type="text" id="batchName" placeholder="Optional batch name">
                        
                        <div class="duplicate-settings">
                            <label for="duplicateHandling">Duplicate Handling:</label>
                            <select id="duplicateHandling">
                                <option value="skip">Skip duplicates (recommended)</option>
                                <option value="update">Update existing records</option>
                                <option value="replace">Replace existing records</option>
                            </select>
                            
                            <label class="checkbox-label">
                                <input type="checkbox" id="forceReprocessing">
                                <span class="checkmark"></span>
                                Force reprocess all images
                            </label>
                        </div>
                    </div>
                    
                    <div class="control-buttons">
                        <button id="startBatch" class="start-btn" disabled>üöÄ Start Processing</button>
                        <button id="pauseBatch" class="pause-btn" disabled>‚è∏Ô∏è Pause</button>
                        <button id="resumeBatch" class="resume-btn" disabled>‚ñ∂Ô∏è Resume</button>
                        <button id="cancelBatch" class="cancel-btn" disabled>‚ùå Cancel</button>
                        <button id="retryFailed" class="retry-btn" disabled>üîÑ Retry Failed</button>
                    </div>
                </div>
                
                <div class="duplicate-statistics" id="duplicateStatistics" style="display: none;">
                    <div class="statistics-header">
                        <h4>üìä Duplicate Detection Statistics</h4>
                        <button id="refreshStats" class="refresh-btn">üîÑ</button>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="totalImagesCount">0</div>
                            <div class="stat-label">Total Images</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="processedImagesCount">0</div>
                            <div class="stat-label">Already Processed</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="newImagesCount">0</div>
                            <div class="stat-label">New Images</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="duplicatesCount">0</div>
                            <div class="stat-label">Duplicates Found</div>
                        </div>
                    </div>
                    
                    <div class="processing-recommendation" id="processingRecommendation">
                        <div class="recommendation-text" id="recommendationText"></div>
                        <div class="recommendation-mode" id="recommendationMode"></div>
                    </div>
                </div>
                
                <div class="batch-progress" id="batchProgress" style="display: none;">
                    <div class="progress-header">
                        <h4>Processing Progress</h4>
                        <span class="batch-status" id="batchStatus">Idle</span>
                    </div>
                    
                    <div class="progress-bar-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="batchProgressFill"></div>
                        </div>
                        <span class="progress-percentage" id="progressPercentage">0%</span>
                    </div>
                    
                    <div class="progress-details">
                        <div class="progress-stats">
                            <span class="stat">
                                <strong>Processed:</strong> <span id="processedCount">0</span>
                            </span>
                            <span class="stat">
                                <strong>Total:</strong> <span id="totalCount">0</span>
                            </span>
                            <span class="stat">
                                <strong>Failed:</strong> <span id="failedCount">0</span>
                            </span>
                            <span class="stat">
                                <strong>Remaining:</strong> <span id="remainingCount">0</span>
                            </span>
                        </div>
                        
                        <div class="current-job" id="currentJob">
                            <strong>Current:</strong> <span id="currentJobName">Waiting...</span>
                        </div>
                    </div>
                </div>
                
                <div class="batch-results" id="batchResults" style="display: none;">
                    <div class="results-header">
                        <h4>Batch Results</h4>
                        <button id="clearResults" class="clear-btn">Clear</button>
                    </div>
                    
                    <div class="results-summary" id="resultsSummary"></div>
                    
                    <div class="failed-jobs" id="failedJobs" style="display: none;">
                        <h5>Failed Images</h5>
                        <div class="failed-list" id="failedList"></div>
                    </div>
                </div>
            </div>

            <div class="admin-tools-section">
                <div class="section-header">
                    <h3>‚ö†Ô∏è Admin Tools</h3>
                    <button id="toggleAdminTools" class="toggle-btn">Show</button>
                </div>
                
                <div class="admin-controls" id="adminControls" style="display: none;">
                    <div class="duplicate-management">
                        <div class="duplicate-management-header">
                            <h4>üîç Duplicate Detection & Cleanup</h4>
                            <p class="info-text">Manage duplicate image records in the database</p>
                        </div>
                        
                        <div class="duplicate-controls">
                            <div class="control-group">
                                <button id="analyzeDuplicates" class="analyze-btn">üîç Analyze Duplicates</button>
                                <button id="refreshDuplicateInfo" class="refresh-btn">üîÑ Refresh</button>
                            </div>
                            
                            <div class="duplicate-analysis" id="duplicateAnalysis" style="display: none;">
                                <div class="analysis-header">
                                    <h5>Analysis Results</h5>
                                    <span class="analysis-timestamp" id="analysisTimestamp"></span>
                                </div>
                                
                                <div class="analysis-stats">
                                    <div class="stat-item">
                                        <div class="stat-value" id="totalImagesAnalyzed">0</div>
                                        <div class="stat-label">Total Images</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="duplicateGroupsFound">0</div>
                                        <div class="stat-label">Duplicate Groups</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="recordsToRemove">0</div>
                                        <div class="stat-label">Records to Remove</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="cleanDataSize">0</div>
                                        <div class="stat-label">Final Clean Size</div>
                                    </div>
                                </div>
                                
                                <div class="recommendations" id="recommendations">
                                    <h6>Recommendations</h6>
                                    <ul class="recommendation-list" id="recommendationList"></ul>
                                </div>
                                
                                <div class="cleanup-actions">
                                    <div class="action-group">
                                        <button id="dryRunCleanup" class="dry-run-btn">üß™ Dry Run</button>
                                        <button id="executeCleanup" class="cleanup-btn" disabled>üßπ Execute Cleanup</button>
                                    </div>
                                    
                                    <div class="cleanup-options">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="confirmCleanup">
                                            <span class="checkmark"></span>
                                            I understand this will permanently remove duplicate records
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="cleanup-results" id="cleanupResults" style="display: none;">
                                <div class="results-header">
                                    <h5>Cleanup Results</h5>
                                    <button id="clearCleanupResults" class="clear-btn">Clear</button>
                                </div>
                                
                                <div class="results-content" id="cleanupResultsContent"></div>
                                
                                <div class="backup-info" id="cleanupBackupInfo" style="display: none;">
                                    <p><strong>Backup created:</strong> <span id="cleanupBackupPath"></span></p>
                                    <button id="rollbackCleanup" class="rollback-btn">üîÑ Rollback</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="backup-management">
                            <div class="backup-header">
                                <h5>üìÅ Backup Management</h5>
                                <button id="refreshBackups" class="refresh-btn">üîÑ</button>
                            </div>
                            
                            <div class="backup-list" id="backupList">
                                <div class="loading-backups">Loading backups...</div>
                            </div>
                        </div>
                    </div>

                    <div class="danger-zone">
                        <div class="danger-zone-header">
                            <h4>üóëÔ∏è Data Destruction (Testing Only)</h4>
                            <p class="warning-text">This will permanently delete all image data. Use only for testing purposes.</p>
                        </div>
                        
                        <div class="data-info">
                            <span class="data-count">Current records: <span id="recordCount">Loading...</span></span>
                        </div>
                        
                        <button id="destroyAllData" class="destroy-btn">Destroy All Image Data</button>
                        
                        <div class="destruction-status" id="destructionStatus" style="display: none;">
                            <div class="status-message" id="destructionMessage"></div>
                            <div class="backup-info" id="backupInfo" style="display: none;">
                                <small>Backup saved: <span id="backupFilename"></span></small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="script.js"></script>
</body>
</html>
