<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhotoVision - Conversational Image Discovery</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/batch-cards.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <div class="header-title">
                    <h1>PhotoVision</h1>
                    <p>Search your SmugMug photos with natural language</p>
                </div>
                <div class="header-controls">
                    <div class="status-bar" id="status">
                        <span class="status-indicator-dot"></span>
                        <span class="status-text">Initializing...</span>
                    </div>
                    <div class="analysis-status-bar" id="analysisStatus">
                        <span class="status-indicator-dot"></span>
                        <span class="status-text">Custom Prompt</span>
                    </div>
                    <div class="theme-toggle" id="themeToggle">
                        <button class="theme-btn" data-theme="light" title="Light Mode">
                            <svg class="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="5"></circle>
                                <path d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"></path>
                            </svg>
                        </button>
                        <button class="theme-btn active" data-theme="auto" title="Auto (System)">
                            <svg class="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                                <line x1="8" y1="21" x2="16" y2="21"></line>
                                <line x1="12" y1="17" x2="12" y2="21"></line>
                            </svg>
                        </button>
                        <button class="theme-btn" data-theme="dark" title="Dark Mode">
                            <svg class="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <nav class="tab-navigation">
            <button class="tab-btn active" data-tab="chat">
                <img src="img/claude-icon.svg" alt="Claude" class="tab-icon">
                <span>Chat</span>
            </button>
            <button class="tab-btn" data-tab="batch">
                <img src="img/smugmug-icon.svg" alt="SmugMug" class="tab-icon">
                <span>Batch Processing</span>
            </button>
            <button class="tab-btn" data-tab="dashboard">
                <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"></path>
                    <polyline points="9,22 9,12 15,12 15,22"></polyline>
                </svg>
                <span>Dashboard</span>
            </button>
            <button class="tab-btn" data-tab="starred">
                <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                </svg>
                <span>Starred</span>
            </button>
        </nav>

        <main class="main">
            <!-- Chat Tab -->
            <div class="tab-panel active" id="chatTab">
                <div class="chat-container">
                    <div class="messages" id="messages">
                        <div class="message system">
                            <div class="message-content">
                                Welcome to PhotoVision! Once you connect your SmugMug account and process your photos, you'll be able to search using natural language queries like "10 photos of young adults smiling" or "photos that feel nostalgic from summer evenings."
                            </div>
                        </div>
                    </div>
                    
                    <div class="input-container">
                        <div class="search-controls" id="searchControls">
                            <div class="search-mode-selector">
                                <button class="search-mode-btn" data-mode="exact" title="Only exact word matches">
                                    <span class="mode-icon">üéØ</span>
                                    <span class="mode-label">Exact</span>
                                </button>
                                <button class="search-mode-btn active" data-mode="smart" title="Smart matching with related terms">
                                    <span class="mode-icon">üß†</span>
                                    <span class="mode-label">Smart</span>
                                </button>
                                <button class="search-mode-btn" data-mode="fuzzy" title="Loose matching with partial words">
                                    <span class="mode-icon">üåä</span>
                                    <span class="mode-label">Fuzzy</span>
                                </button>
                                <button class="search-mode-btn" data-mode="custom" title="Custom search settings">
                                    <span class="mode-icon">‚öôÔ∏è</span>
                                    <span class="mode-label">Custom</span>
                                </button>
                            </div>
                            <div class="search-quick-options">
                                <label class="search-option">
                                    <input type="checkbox" id="includeSimilar" checked>
                                    <span>Similar words</span>
                                </label>
                                <label class="search-option">
                                    <input type="checkbox" id="requireAll">
                                    <span>All words</span>
                                </label>
                                <label class="search-option">
                                    <input type="checkbox" id="descriptionsOnly">
                                    <span>Descriptions only</span>
                                </label>
                            </div>
                            <div class="search-custom-panel" id="customSearchPanel" style="display: none;">
                                <div class="custom-option">
                                    <label>Minimum relevance score:</label>
                                    <input type="range" id="minScore" min="0" max="20" value="0" step="1">
                                    <span id="minScoreValue">0</span>
                                </div>
                                <div class="custom-option">
                                    <label>Search in:</label>
                                    <div class="field-checkboxes">
                                        <label><input type="checkbox" name="searchField" value="keywords" checked> Keywords</label>
                                        <label><input type="checkbox" name="searchField" value="description" checked> Description</label>
                                        <label><input type="checkbox" name="searchField" value="title" checked> Title</label>
                                        <label><input type="checkbox" name="searchField" value="caption" checked> Caption</label>
                                        <label><input type="checkbox" name="searchField" value="album" checked> Album</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="input-wrapper">
                            <input type="text" id="messageInput" placeholder="Ask me to find photos: 'show me archery photos' or 'find 3 smiling people'..." disabled>
                            <button id="sendButton" disabled>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="22" y1="2" x2="11" y2="13"></line>
                                    <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="upload-section">
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-content">
                            <div class="upload-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path>
                                    <polyline points="7,10 12,15 17,10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                            </div>
                            <h3>Upload Images</h3>
                            <p>Drag and drop images here or click to select</p>
                            <input type="file" id="fileInput" accept="image/*" style="display: none;">
                            <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                                Choose Image
                            </button>
                        </div>
                    </div>
                    <div class="upload-progress" id="uploadProgress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <span class="progress-text" id="progressText">Analyzing...</span>
                    </div>
                    <div class="analysis-result" id="analysisResult" style="display: none;">
                        <h4>Analysis Result:</h4>
                        <div class="result-content" id="resultContent"></div>
                    </div>
                </div>
            </div>

            <!-- Batch Processing Tab -->
            <div class="tab-panel" id="batchTab">
                <div class="batch-processing-section">
                    <div class="section-header">
                        <h3>Album Batch Processing</h3>
                        <div class="header-actions">
                            
                            <div class="batch-actions">
                                <button id="startBatch" class="btn btn-primary btn-compact" disabled title="Start Processing">
                                    <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                                        <polygon points="5,3 19,12 5,21"></polygon>
                                    </svg>
                                </button>
                                <button id="pauseBatch" class="btn btn-secondary btn-compact" disabled title="Pause">
                                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="6" y="4" width="4" height="16"></rect>
                                        <rect x="14" y="4" width="4" height="16"></rect>
                                    </svg>
                                </button>
                                <button id="resumeBatch" class="btn btn-secondary btn-compact" disabled title="Resume">
                                    <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                                        <polygon points="5,3 19,12 5,21"></polygon>
                                    </svg>
                                </button>
                                <button id="cancelBatch" class="btn btn-danger btn-compact" disabled title="Cancel">
                                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>
                            <button id="refreshAlbums" class="refresh-btn">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23,4 23,10 17,10"></polyline>
                                    <polyline points="1,20 1,14 7,14"></polyline>
                                    <path d="M20.49,9A9,9,0,0,0,5.64,5.64L1,10m22,4-4.64,4.36A9,9,0,0,1,3.51,15"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="albums-container">
                        <div class="albums-header">
                            <!-- <h4>Select Album to Process</h4> -->
                            <div class="batch-controls-header">
                                <div class="max-images-control">
                                    <label for="maxImages">Amount of Images to Batch Process</label>
                                    <div class="input-with-slider">
                                        <input type="range" id="maxImagesSlider" min="1" max="200" value="50" class="slider">
                                        <input type="number" id="maxImages" value="50" min="1" max="200" class="number-input" readonly>
                                    </div>
                                </div>
                                <div class="batch-name-control">
                                    <label for="batchName">Batch Name</label>
                                    <input type="text" id="batchName" placeholder="Auto-generated" class="batch-name-input">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Filter and Sort Controls -->
                        <div class="album-filters">
                            <div class="filter-row">
                                <div class="search-group">
                                    <input type="text" id="albumSearch" placeholder="Search albums..." class="search-input">
                                    <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <path d="M21 21l-4.35-4.35"></path>
                                    </svg>
                                </div>
                                
                                <div class="filter-group">
                                    <label for="statusFilter">Status:</label>
                                    <select id="statusFilter" class="filter-select">
                                        <option value="all">All Albums</option>
                                        <option value="processed">Fully Processed</option>
                                        <option value="partial">Partially Processed</option>
                                        <option value="unprocessed">Unprocessed</option>
                                        <option value="failed">Failed</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group">
                                    <label for="sortOrder">Sort:</label>
                                    <select id="sortOrder" class="filter-select">
                                        <option value="name-asc">Name A-Z</option>
                                        <option value="name-desc">Name Z-A</option>
                                        <option value="count-desc">Image Count (High-Low)</option>
                                        <option value="count-asc">Image Count (Low-High)</option>
                                        <option value="level-asc">Hierarchy Level</option>
                                        <option value="date-desc">Date Created (Newest First)</option>
                                        <option value="date-asc">Date Created (Oldest First)</option>
                                        <option value="updated-desc">Last Updated (Newest First)</option>
                                        <option value="updated-asc">Last Updated (Oldest First)</option>
                                    </select>
                                </div>
                                
                                <button id="clearFilters" class="btn btn-secondary filter-clear">
                                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                    Clear
                                </button>
                            </div>
                            
                            <div class="active-filters" id="activeFilters" style="display: none;">
                                <span class="filter-label">Active filters:</span>
                                <div class="filter-tags" id="filterTags"></div>
                            </div>
                        </div>
                        
                    
                        
                        <div class="albums-list" id="albumsList">
                            <div class="loading-albums">
                                <div class="loading-spinner"></div> Loading albums...
                            </div>
                        </div>
                    </div>
                    
                    <div class="batch-progress" id="batchProgress" style="display: none;">
                        <div class="progress-header">
                            <h4>Processing Progress</h4>
                            <span class="batch-status" id="batchStatus">Idle</span>
                        </div>
                        
                        <div class="progress-bar-container">
                            <div class="progress-bar">
                                <div class="progress-fill" id="batchProgressFill"></div>
                            </div>
                            <span class="progress-percentage" id="progressPercentage">0%</span>
                        </div>
                        
                        <div class="progress-stats">
                            <div class="stat-item">
                                <span class="stat-label">Processed:</span>
                                <span class="stat-value" id="processedCount">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Total:</span>
                                <span class="stat-value" id="totalCount">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Failed:</span>
                                <span class="stat-value" id="failedCount">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Remaining:</span>
                                <span class="stat-value" id="remainingCount">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div class="tab-panel" id="dashboardTab">
                <div class="dashboard-section">
                    <div class="section-header">
                        <h3>System Status</h3>
                        <div class="section-header-right">
                            <small>Last checked: <span id="lastChecked">Never</span></small>
                            <button id="refreshStatus" class="refresh-btn">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23,4 23,10 17,10"></polyline>
                                    <polyline points="1,20 1,14 7,14"></polyline>
                                    <path d="M20.49,9A9,9,0,0,0,5.64,5.64L1,10m22,4-4.64,4.36A9,9,0,0,1,3.51,15"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="services-grid">
                        <div class="service-card" id="claudeStatusCard">
                            <div class="service-icon">
                                <img src="img/claude-icon.svg" alt="Claude AI" class="service-icon-img">
                            </div>
                            <div class="service-info">
                                <div class="service-name">Claude AI</div>
                                <div class="service-status" id="claudeStatus">
                                    <span class="status-indicator checking"></span>
                                    <span class="status-text">Checking...</span>
                                </div>
                            </div>
                            <div class="service-actions">
                                <button id="testClaude" class="btn btn-secondary">Test</button>
                                <button id="configureApiKey" class="btn btn-primary" onclick="window.photoVision.navigateToApiConfig()">Configure</button>
                            </div>
                        </div>
                        
                        <div class="service-card" id="smugmugStatusCard">
                            <div class="service-icon">
                                <img src="img/smugmug-icon.svg" alt="SmugMug" class="service-icon-img">
                            </div>
                            <div class="service-info">
                                <div class="service-name">SmugMug</div>
                                <div class="service-status" id="smugmugStatus">
                                    <span class="status-indicator disconnected"></span>
                                    <span class="status-text">Not Connected</span>
                                </div>
                                <div class="account-details" id="accountDetails" style="display: none;"></div>
                            </div>
                            <div class="service-actions">
                                <button id="connectSmugmug" class="btn btn-primary">Connect</button>
                                <button id="testSmugmug" class="btn btn-secondary" disabled>Test</button>
                                <button id="disconnectSmugmug" class="btn btn-danger" disabled>Disconnect</button>
                            </div>
                        </div>
                    </div>
                    
                </div>
                
                <!-- Admin Tools Section in Dashboard -->
                <div class="admin-tools-section">
                    <div class="section-header">
                        <h3>Admin Tools</h3>
                        <div class="admin-badge">
                            <svg class="admin-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 1l3 6 6 .75-4.15 4.2.9 6.05L12 15l-5.75 3-0.9-6.05L1 7.75 7 7l3-6z"></path>
                            </svg>
                            <span>Advanced</span>
                        </div>
                    </div>
                    
                    <div class="admin-controls" id="adminControls">
                        <div class="admin-card" id="apiConfigurationCard">
                            <div class="admin-card-header">
                                <h4>
                                    <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="11" width="18" height="10" rx="2" ry="2"></rect>
                                        <path d="M7 11V7a5 5 0 0110 0v4"></path>
                                    </svg>
                                    API Configuration
                                </h4>
                                <p class="card-description">Manage your Claude API credentials</p>
                            </div>
                            
                            <div class="admin-card-content">
                                <div class="current-api-key-info" id="currentApiKeyInfo">
                                    <!-- API key status will be displayed here -->
                                </div>
                                
                                <div class="status-message" id="apiKeyStatus" style="display: none;">
                                    <!-- Status messages will appear here -->
                                </div>
                                
                                <div class="api-key-form" id="apiKeyForm">
                                    <div class="form-group api-key-group">
                                        <label for="claudeApiKey" class="api-key-label">
                                            <svg class="label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="11" width="18" height="10" rx="2" ry="2"></rect>
                                                <path d="M7 11V7a5 5 0 0110 0v4"></path>
                                            </svg>
                                            Claude API Key
                                        </label>
                                        <div class="api-key-input-wrapper">
                                            <div class="api-key-icon">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <rect x="3" y="11" width="18" height="10" rx="2" ry="2"></rect>
                                                    <path d="M7 11V7a5 5 0 0110 0v4"></path>
                                                </svg>
                                            </div>
                                            <input type="password" 
                                                   id="claudeApiKey" 
                                                   class="api-key-input enhanced" 
                                                   placeholder="sk-ant-api03-..." 
                                                   autocomplete="off"
                                                   spellcheck="false">
                                            <button type="button" class="toggle-visibility enhanced" id="toggleApiKeyVisibility" title="Toggle visibility">
                                                <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                    <circle cx="12" cy="12" r="3"></circle>
                                                </svg>
                                                <svg class="eye-off-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                                                    <path d="M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24"></path>
                                                    <line x1="1" y1="1" x2="23" y2="23"></line>
                                                </svg>
                                            </button>
                                        </div>
                                        <small class="form-text api-key-hint">
                                            <svg class="hint-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M9 11l3 3L22 4"></path>
                                                <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path>
                                            </svg>
                                            Your API key will be encrypted and stored securely
                                        </small>
                                    </div>
                                    
                                    <div class="control-group">
                                        <button id="saveApiKey" class="btn btn-primary">
                                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"></path>
                                                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                                <polyline points="7 3 7 8 15 8"></polyline>
                                            </svg>
                                            Save API Key
                                        </button>
                                        <button id="testApiKey" class="btn btn-secondary">
                                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M22 11.08V12a10 10 0 11-5.93-9.14"></path>
                                                <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                            </svg>
                                            Test Connection
                                        </button>
                                    </div>
                                    
                                    <div class="migration-notice" id="migrationNotice" style="display: none;">
                                        <p>
                                            <svg class="notice-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <line x1="12" y1="8" x2="12" y2="12"></line>
                                                <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                            </svg>
                                            API key found in environment variables. 
                                            <button id="migrateApiKey" class="btn btn-link">Migrate to secure storage</button>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="admin-card" id="duplicateDetectionCard">
                            <div class="admin-card-header">
                                <h4>
                                    <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <path d="M21 21l-4.35-4.35"></path>
                                    </svg>
                                    Duplicate Detection & Cleanup
                                </h4>
                                <p class="card-description">Manage duplicate image records in the database</p>
                            </div>
                            
                            <div class="admin-card-content">
                                <div class="control-group">
                                    <button id="analyzeDuplicates" class="btn btn-primary">
                                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="11" cy="11" r="8"></circle>
                                            <path d="M21 21l-4.35-4.35"></path>
                                        </svg>
                                        Analyze Duplicates
                                    </button>
                                    <button id="refreshDuplicateInfo" class="btn btn-secondary">
                                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="23,4 23,10 17,10"></polyline>
                                            <polyline points="1,20 1,14 7,14"></polyline>
                                            <path d="M20.49,9A9,9,0,0,0,5.64,5.64L1,10m22,4-4.64,4.36A9,9,0,0,1,3.51,15"></path>
                                        </svg>
                                        Refresh
                                    </button>
                                </div>
                                
                                <div class="duplicate-settings-admin">
                                    <h5>Processing Settings</h5>
                                    <div class="setting-group">
                                        <label for="duplicateHandling">Duplicate Handling:</label>
                                        <select id="duplicateHandling">
                                            <option value="skip">Skip duplicates (recommended)</option>
                                            <option value="update">Update existing records</option>
                                            <option value="replace">Replace existing records</option>
                                        </select>
                                    </div>
                                    
                                    <div class="toggle-switch-wrapper">
                                        <span class="toggle-switch-label">Force reprocess all images</span>
                                        <label class="toggle-switch" data-toggle="force-reprocessing">
                                            <input type="checkbox" id="forceReprocessing">
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="duplicate-analysis" id="duplicateAnalysis" style="display: none;">
                                    <div class="analysis-results">
                                        <h5>Analysis Results</h5>
                                        <div class="stats-grid">
                                            <div class="stat-card">
                                                <div class="stat-value" id="totalImagesAnalyzed">0</div>
                                                <div class="stat-label">Total Images</div>
                                            </div>
                                            <div class="stat-card">
                                                <div class="stat-value" id="duplicateGroupsFound">0</div>
                                                <div class="stat-label">Duplicate Groups</div>
                                            </div>
                                            <div class="stat-card">
                                                <div class="stat-value" id="recordsToRemove">0</div>
                                                <div class="stat-label">Records to Remove</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="admin-card" id="imageAnalysisCard">
                            <div class="admin-card-header">
                                <div class="admin-card-header-content">
                                    <h4>
                                        <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M9 12l2 2 4-4"></path>
                                            <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                                            <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                                        </svg>
                                        Image Analysis Configuration
                                        <button class="help-icon" id="analysisHelpIcon" title="Tips for effective pre-context">
                                            <svg viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                                            </svg>
                                        </button>
                                    </h4>
                                    <p class="card-description">Customize how AI analyzes your images with custom pre-context prompts</p>
                                    
                                    <!-- Help block content -->
                                    <div class="help-block" id="analysisHelpBlock" style="display: none;">
                                        <h5>Tips for Effective Pre-Context:</h5>
                                        <ul>
                                            <li>Be specific about the type of images you're analyzing</li>
                                            <li>Mention key elements to focus on (technique, equipment, emotions)</li>
                                            <li>Use terminology relevant to your domain</li>
                                            <li>Keep it concise but descriptive</li>
                                            <li>Test with sample images to verify results</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="admin-card-header-controls">
                                    <div class="toggle-switch-wrapper">
                                        <span class="toggle-switch-label">Enable</span>
                                        <label class="toggle-switch" data-toggle="image-analysis">
                                            <input type="checkbox" id="enableCustomAnalysis">
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="admin-card-content">
                                
                                <div class="template-selection">
                                    <label for="analysisTemplate">Quick Templates:</label>
                                    <select id="analysisTemplate" class="template-select">
                                        <option value="">Custom user input (use text area below)</option>
                                    </select>
                                </div>
                                
                                <div class="context-input-section">
                                    <label for="preContextInput">Custom Pre-Context:</label>
                                    <textarea id="preContextInput" 
                                              class="context-textarea" 
                                              placeholder="Enter custom context that will be added before the default analysis prompt. For example: 'You are analyzing photos from an archery competition. Focus on athletic performance, technique, equipment, and competitive atmosphere.'"
                                              rows="6">Please analyze this image in detail. Provide a comprehensive description and generate relevant keywords for indexing. Return your response as a JSON object with the following structure:

{
  "description": "A detailed description of the image...",
  "keywords": ["keyword1", "keyword2", "keyword3", ...]
}

For the description, include:
1. Main subjects (people, objects, animals)
2. Setting and location type
3. Activities or actions taking place
4. Mood, lighting, and atmosphere
5. Colors, composition, and visual elements
6. Any text or signs visible
7. Time of day or season if apparent

For keywords, provide 5-10 relevant terms that would help with searching and indexing, such as:
- Main subjects (person, animal, object types)
- Activities (running, eating, playing)
- Settings (outdoor, indoor, beach, forest)
- Emotions/moods (happy, serious, peaceful)
- Visual elements (colorful, black and white, sunset)
- Equipment or objects visible

Be specific and descriptive to enable natural language searches like "photos of people laughing outdoors" or "sunset landscapes with mountains".</textarea>
                                    <div class="input-meta">
                                        <span class="char-count">
                                            <span id="contextCharCount">0</span> / 2000 characters
                                        </span>
                                        <span class="input-help">
                                            This context will be added before the standard analysis instructions.
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="control-group">
                                    <button id="saveAnalysisConfig" class="btn btn-primary">
                                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"></path>
                                            <polyline points="17,21 17,13 7,13 7,21"></polyline>
                                            <polyline points="7,3 7,8 15,8"></polyline>
                                        </svg>
                                        Save Configuration
                                    </button>
                                    <button id="resetAnalysisConfig" class="btn btn-secondary">
                                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="1,4 1,10 7,10"></polyline>
                                            <polyline points="23,20 23,14 17,14"></polyline>
                                            <path d="M20.49,9A9,9,0,0,0,5.64,5.64L1,10m22,4-4.64,4.36A9,9,0,0,1,3.51,15"></path>
                                        </svg>
                                        Reset to Default
                                    </button>
                                </div>
                                
                                <div class="accordion-wrapper">
                                    <button class="accordion-header" id="previewAccordionBtn">
                                        <div class="accordion-title">
                                            <svg class="accordion-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                <circle cx="12" cy="12" r="3"></circle>
                                            </svg>
                                            Preview Complete Prompt
                                        </div>
                                        <svg class="accordion-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="6,9 12,15 18,9"></polyline>
                                        </svg>
                                    </button>
                                    
                                    <div class="accordion-content" id="previewAccordionContent">
                                        <p class="preview-placeholder">The complete prompt preview will appear here automatically as you type in the textarea above.</p>
                                    </div>
                                </div>
                                
                                <!-- Configuration Testing Section -->
                                <div class="accordion-wrapper">
                                    <button class="accordion-header" id="testingAccordionBtn">
                                        <div class="accordion-title">
                                            <svg class="accordion-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M9 12l2 2 4-4"></path>
                                                <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                                                <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                                            </svg>
                                            Test Configuration with Images
                                        </div>
                                        <svg class="accordion-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="6,9 12,15 18,9"></polyline>
                                        </svg>
                                    </button>
                                    
                                    <div class="accordion-content" id="testingAccordionContent">
                                        <p class="testing-description">Upload one or more images to test your current analysis configuration. This helps you verify your custom prompts before running batch processing.</p>
                                        
                                        <div class="testing-controls">
                                            <div class="comparison-toggle-wrapper">
                                                <label class="comparison-toggle">
                                                    <input type="checkbox" id="enableComparison" checked>
                                                    <span class="toggle-slider"></span>
                                                </label>
                                                <div class="toggle-info">
                                                    <span class="toggle-label">Show comparison with default analysis</span>
                                                    <p class="toggle-description">When enabled, each image will be analyzed with both your custom configuration and the default settings to show the difference.</p>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="config-testing-section">
                                            <div class="test-upload-area" id="testUploadArea">
                                                <div class="test-upload-content">
                                                    <div class="upload-icon">
                                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path>
                                                            <polyline points="7,10 12,15 17,10"></polyline>
                                                            <line x1="12" y1="15" x2="12" y2="3"></line>
                                                        </svg>
                                                    </div>
                                                    <h4>Test Images Upload</h4>
                                                    <p>Drag and drop images here or click to select multiple files</p>
                                                    <input type="file" id="testFileInput" accept="image/*" multiple style="display: none;">
                                                    <button class="btn btn-secondary" onclick="document.getElementById('testFileInput').click()">
                                                        Choose Images
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div class="test-progress" id="testProgress" style="display: none;">
                                                <div class="progress-header">
                                                    <h5>Testing Progress</h5>
                                                    <span class="test-status" id="testStatus">Processing...</span>
                                                </div>
                                                <div class="progress-bar-container">
                                                    <div class="progress-bar">
                                                        <div class="progress-fill" id="testProgressFill"></div>
                                                    </div>
                                                    <span class="progress-percentage" id="testProgressPercentage">0%</span>
                                                </div>
                                                <div class="progress-stats">
                                                    <span class="stat-text">Processing <span id="testCurrentFile">file</span>... (<span id="testProcessedCount">0</span> of <span id="testTotalCount">0</span>)</span>
                                                </div>
                                            </div>
                                            
                                            <div class="test-results-summary" id="testResultsSummary" style="display: none;">
                                                <div class="results-summary-card">
                                                    <div class="summary-info">
                                                        <h5>Analysis Complete</h5>
                                                        <p id="resultsSummaryText">0 images processed successfully</p>
                                                    </div>
                                                    <div class="summary-actions">
                                                        <button id="viewTestResults" class="btn btn-primary">
                                                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                                <circle cx="12" cy="12" r="3"></circle>
                                                            </svg>
                                                            View Results
                                                        </button>
                                                        <button id="clearTestResults" class="btn btn-secondary">
                                                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                                                <line x1="6" y1="6" x2="18" y2="18"></line>
                                                            </svg>
                                                            Clear
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </div>

                        <div class="admin-card" id="modelConfigCard">
                            <div class="admin-card-header">
                                <h4>
                                    <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 2L2 7v10c0 5.55 3.84 10 9 10s9-4.45 9-10V7L12 2z"></path>
                                        <path d="M12 8v8"></path>
                                        <path d="M8 12h8"></path>
                                    </svg>
                                    Claude Model Configuration
                                </h4>
                                <p class="card-description">Configure which Claude models to use for different tasks. Choose models based on your needs for speed, cost, and capability.</p>
                            </div>
                            
                            <div class="admin-card-content">
                                <div class="config-section">
                                    <label for="chatModelSelect" class="config-label">
                                        <svg class="label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                        </svg>
                                        Chat & Search Model
                                    </label>
                                    <select id="chatModelSelect" class="config-select">
                                        <option value="">Loading...</option>
                                    </select>
                                    <p class="config-help">Used for conversational search and chat interactions. Prioritize intelligence and reasoning capability.</p>
                                </div>
                                
                                <div class="config-section">
                                    <label for="batchModelSelect" class="config-label">
                                        <svg class="label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                            <circle cx="9" cy="9" r="2"></circle>
                                            <path d="M21 15l-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path>
                                        </svg>
                                        Batch Processing Model
                                    </label>
                                    <select id="batchModelSelect" class="config-select">
                                        <option value="">Loading...</option>
                                    </select>
                                    <p class="config-help">Used for image analysis and batch processing. Prioritize speed and cost efficiency.</p>
                                </div>
                                
                                <div class="config-actions">
                                    <button id="saveModelConfig" class="btn btn-primary">
                                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                            <polyline points="17,21 17,13 7,13 7,21"></polyline>
                                            <polyline points="7,3 7,8 15,8"></polyline>
                                        </svg>
                                        Save Model Configuration
                                    </button>
                                    <button id="resetModelConfig" class="btn btn-secondary">
                                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="1,4 1,10 7,10"></polyline>
                                            <polyline points="23,20 23,14 17,14"></polyline>
                                            <path d="M20.49,9A9,9,0,0,0,5.64,5.64L1,10m22,4-4.64,4.36A9,9,0,0,1,3.51,15"></path>
                                        </svg>
                                        Reset to Default
                                    </button>
                                </div>
                                
                                <div class="model-info" id="modelInfo" style="display: none;">
                                    <div class="model-info-section">
                                        <h5>Chat Model Info</h5>
                                        <div id="chatModelInfo" class="model-details"></div>
                                    </div>
                                    <div class="model-info-section">
                                        <h5>Batch Processing Model Info</h5>
                                        <div id="batchModelInfo" class="model-details"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="admin-card danger-zone" id="dataDestructionCard">
                            <div class="admin-card-header">
                                <h4>
                                    <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3,6 5,6 21,6"></polyline>
                                        <path d="M19,6V20a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6M8,6V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"></path>
                                    </svg>
                                    Data Destruction (Testing Only)
                                </h4>
                                <p class="card-description warning">This will permanently delete all image data. Use only for testing purposes.</p>
                            </div>
                            
                            <div class="admin-card-content">
                                <div class="data-info">
                                    <span class="data-count">Current records: <span id="recordCount">Loading...</span></span>
                                </div>
                                
                                <button id="destroyAllData" class="btn btn-danger">
                                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3,6 5,6 21,6"></polyline>
                                        <path d="M19,6V20a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6M8,6V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"></path>
                                    </svg>
                                    Destroy All Image Data
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Starred Tab -->
            <div class="tab-panel" id="starredTab">
                <!-- Content will be dynamically loaded by JavaScript -->
            </div>
        </main>
    </div>

    <!-- Lightbox Modal -->
    <div id="imageModal" class="image-modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-container">
            <button class="modal-close" id="closeModal">&times;</button>
            <div class="swiper-container" id="imageSwiper">
                <div class="swiper-wrapper" id="swiperWrapper">
                    <!-- Slides will be populated dynamically -->
                </div>
                <div class="swiper-pagination"></div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
            </div>
            <div class="image-info" id="imageInfo">
                <div class="image-counter" id="imageCounter">1 / 1</div>
                <div class="image-title" id="imageTitle">Image Title</div>
            </div>
        </div>
    </div>

    <!-- Test Results Modal -->
    <div id="testResultsModal" class="test-results-modal" style="display: none;">
        <div class="test-results-modal-overlay"></div>
        <div class="test-results-modal-content">
            <div class="test-results-modal-header">
                <div class="modal-header-left">
                    <h3>Test Results</h3>
                    <span class="results-count" id="modalResultsCount">0 images analyzed</span>
                </div>
                <div class="modal-header-right">
                    <button class="modal-close" id="closeTestResultsModal">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="test-results-modal-body" id="testResultsModalBody">
                <div class="modal-results-container" id="modalResultsContainer">
                    <!-- Results will be populated here -->
                </div>
            </div>
            <div class="test-results-modal-footer">
                <button id="clearTestResultsModal" class="btn btn-secondary">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                    Clear All Results
                </button>
                <button id="closeTestResultsModalBtn" class="btn btn-primary">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Floating Batch Progress Cards Container -->
    <div id="batchCardsContainer" class="batch-cards-container">
        <!-- Batch cards will be dynamically added here -->
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
